<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Auth</title>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
		/>
		<script src="https://telegram.org/js/telegram-web-app.js?56"></script>
	</head>
	<body>
		<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
		<script>
			window.AuthPostRequest = {}

			window.AuthPostRequest.initialize = function (post_url) {
				// const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
				const csrfToken = "{{ secret_key }}"
				const init_data = window.Telegram.WebApp.initData

				$.ajax({
					url: post_url,
					type: 'POST',
					data: {
						csrf_token: csrfToken,
						initData: init_data,
					},
					success: function (response) {
						window.location.href = response.redirect_url
					},
					error: function (xhr, status, error) {
						window.location.href = 'auth/error'
						console.log(error)
					},
				})
			}

			window.AuthPostRequest.initialize(window.location.href)
		</script>
	</body>
</html>

